<!-- TODO: 
		* Fill out entire 512x512 space with hexes
		* Make time toggle bar
		* Have actual map beside hexbins
		* Have some sort of feature that highlights the location 
		  of the hexbin under consideration on the actual map.
 -->

<!DOCTYPE html>
<html>
<head>
	<script src='https://d3js.org/d3.v4.js'></script>
	<script src='js\d3.hexbin.min.js'></script>
	<style type="text/css">
		.hexagon {
		  stroke: #000;
		  stroke-opacity: .2;
		}
	</style>
</head>
<body>
	<script type="text/javascript">
		d3.csv('death_location.csv', function(death_loc) {
			var url_summoners = 'https://s3-us-west-1.amazonaws.com/riot-api/img/minimap-ig.png';

			var dim = {
				w: 512,
				h: 512
			};
			
			var domain = {
				min: {x: 0, y: 0},
				max: {x: 14820, y: 14881}
			};

			var xScale = d3.scaleLinear()
				.domain([domain.min.x, domain.max.x])
				.range([0, dim.w]);

			var yScale = d3.scaleLinear()
				.domain([domain.min.y, domain.max.y])
				.range([dim.h, 0]);

			var hexbin = d3.hexbin()
				.size([dim.w, dim.h])
				.x(function(d) { return d.x; })
				.y(function(d) { return d.y; })
				.radius(2);

			death_loc.forEach(function(el) {
				el.x = xScale(el.x)
				el.y = yScale(el.y)
			});

			var hbin_data = hexbin(death_loc);

			var min_time = d3.min(death_loc, function(d) { return d.timestamp; }),
				max_time = d3.max(death_loc, function(d) { return d.timestamp; });

			// Note: domain maximum is max count out of all hexbins
			var color = d3.scaleSequential(d3.interpolateInferno)
			    	.domain([0, d3.max(hbin_data, function(d) { return d.length; })]);

			var svg = d3.select('body')
				.append('svg')
					.attr('width', dim.w)
					.attr('height', dim.h);

			svg.append('image')
			    .attr('xlink:href', url_summoners)
			    .attr('x', '0')
			    .attr('y', '0')
			    .attr('width', dim.w)
			    .attr('height', dim.h);

			svg.append('clipPath')
				.attr('id', 'clip')
				.append('rect')
					.attr('class', 'mesh')
					.attr('width', dim.w)
					.attr('height', dim.h);

			svg.append('g')
				.attr('clip-path', 'url(#clip)')
				.selectAll('.hexagon')
					.data(hexbin(death_loc)).enter()
				.append('path')
					.attr('class', 'hexagon')
					.attr('d', hexbin.hexagon())
					.attr('transform', function(d) { 
						return 'translate(' + d.x + ',' + d.y + ')';
					})
					.style('fill', function(d) { return color(d.length); });
			});
	</script>
</body>
</html>